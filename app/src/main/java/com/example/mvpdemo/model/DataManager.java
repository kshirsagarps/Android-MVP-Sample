package com.example.mvpdemo.model;

import android.os.AsyncTask;

import com.example.mvpdemo.R;
import com.example.mvpdemo.application.MVPDemo;
import com.google.gson.Gson;

import java.lang.ref.WeakReference;

/**
 * Created by pratyush on 5/24/16.
 */
public class DataManager {

    private FetchDataTask mFetchDataTask;

    public void getData(ModelChangeListener listener) {
        if (mFetchDataTask != null && mFetchDataTask.getStatus() == AsyncTask.Status.RUNNING) {
            mFetchDataTask.cancel(true);
        }
        mFetchDataTask = new FetchDataTask(listener);
        mFetchDataTask.execute();
    }

    public void cancelData() {
        if (mFetchDataTask != null && mFetchDataTask.getStatus() == AsyncTask.Status.RUNNING) {
            mFetchDataTask.cancel(true);
        }
    }

    private static class FetchDataTask  extends AsyncTask<Void,Void,DDGOPhoto> {
        WeakReference<ModelChangeListener> weakReference;

        public FetchDataTask(ModelChangeListener modelChangeListener) {
            weakReference = new WeakReference<>(modelChangeListener);
        }

        @Override
        protected DDGOPhoto doInBackground(Void... params) {
            try {
                Thread.sleep(3000);
                Gson gson = new Gson();
                DDGOPhoto ddgoPhoto = gson.fromJson(JSON, DDGOPhoto.class);
                return ddgoPhoto;
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            return null;
        }

        @Override
        protected void onPostExecute(DDGOPhoto ddgoPhoto) {
            super.onPostExecute(ddgoPhoto);
            ModelChangeListener modelChangeListener = weakReference.get();
            if (modelChangeListener != null)
                if (ddgoPhoto != null) {
                    modelChangeListener.onSuccess(ddgoPhoto);
                    return;
                }
            modelChangeListener.onError(MVPDemo.getContext().getResources().getString(R.string.error_model_change));
        }
    }
















    public static final String JSON = "{\"ads\":null,\"next\":\"i.js?q=national%20geographic&p=strict&s=35&u=yahoo&l=us-en\",\"query\":\"national geographic\",\"results\":[{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.Ma342f5aad1b7fc06a9de2ea89c2040f1H0&pid=15.1\",\"url\":\"http://www.taringa.net/posts/imagenes/16455815/Los-Mejores-Wallpaper-de-National-Geographic.html\",\"title\":\"Los Mejores Wallpaper de National Geographic - Taringa!\",\"height\":1200,\"image\":\"http://www.ozoneeleven.com/wp-content/uploads/2010/07/3694_1600x1200.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.Mc0fdd2258dc462f9e9ad4069231b98d0o0&pid=15.1\",\"url\":\"http://mariaxhe.blogspot.com/2012/02/national-geographic_19.html\",\"title\":\"MariaJose: National Geographic\",\"height\":1200,\"image\":\"http://1.bp.blogspot.com/-NYFk-IDAgG8/TlkYh3jFEMI/AAAAAAAABg0/wO1rB8sbmqs/s1600/National+Geographic+%2528152%2529.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse1.mm.bing.net/th?id=OIP.M2a4d00d852d58ad56072bed640486430H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 1\",\"height\":768,\"image\":\"http://3.bp.blogspot.com/-_w-_JTiXjqE/UMi6VhxiHGI/AAAAAAAADEg/ZW-HlF2ezQU/s1600/National+Geographic+HD+Wallpapers.jpeg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.M959d1bc1b2f05e3b53de3d24424531abH0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_2932.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 10\",\"height\":1200,\"image\":\"http://3.bp.blogspot.com/-HVgdd0HbPzU/UMtLVe595lI/AAAAAAAADQE/yDrsPnx9osM/s1600/National+Geographic+HD+Wallpapers+93.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse1.mm.bing.net/th?id=OIP.M2b8f6c0ff4073808f39d05f55650a1aaH0&pid=15.1\",\"url\":\"http://www.inicioo.com/selec/wall/National_Geographic/ng.htm\",\"title\":\"NATIONAL GEOGRAPHIC (44)\",\"height\":768,\"image\":\"http://www.inicioo.com/selec/wall/National_Geographic/NG/National%20Geographic%20Wallpapers%20002.jpg\"},{\"source\":\"Yahoo\",\"width\":960,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.M6e98780d1d4e90548548bbb86d7a8c69H0&pid=15.1\",\"url\":\"http://aisyaismail.blogspot.com/2010/11/national-geographic.html\",\"title\":\"NATIONAL GEOGRAPHIC\",\"height\":768,\"image\":\"http://1.bp.blogspot.com/_CvmB2WtpwFI/TNxavoaQb5I/AAAAAAAAAGU/CIG2JLHz5sQ/s1600/national-geographic01.jpg\"},{\"source\":\"Yahoo\",\"width\":1680,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.M6d9dfabb891057b156fa5e36151b8173H0&pid=15.1\",\"url\":\"http://www.fanpop.com/clubs/national-geographic/images/7018225/title/nature-around-world-wallpaper\",\"title\":\"National Geographic Nature / Around the World\",\"height\":1050,\"image\":\"http://images2.fanpop.com/images/photos/7000000/Nature-Around-the-World-national-geographic-7018225-1680-1050.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse2.mm.bing.net/th?id=OIP.Mef4acf95567c27afc4bdc7336c833a78H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_1595.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 2\",\"height\":768,\"image\":\"http://4.bp.blogspot.com/-YfnMb36RsWA/UMtCYptj3vI/AAAAAAAADIQ/2LAeSWfSlHw/s1600/National%2BGeographic%2BHD%2BWallpapers%2B31.jpeg\"},{\"source\":\"Yahoo\",\"width\":1280,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.M627d0b4303af62272bf2bafd518a12f3H0&pid=15.1\",\"url\":\"http://www.fanpop.com/clubs/national-geographic/images/12536758/title/national-geographic-photos-wallpaper\",\"title\":\"National Geographic Photos - National Geographic Wallpaper (12536758 ...\",\"height\":1024,\"image\":\"http://images2.fanpop.com/image/photos/12500000/National-Geographic-Photos-national-geographic-12536758-1280-1024.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.M880f118f6ec7e7e4c154ce4a73e5d98fH0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_1595.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 2\",\"height\":768,\"image\":\"http://4.bp.blogspot.com/-RIKUkHCNV2E/UMtCafpajhI/AAAAAAAADIc/L3L9FbZkvm4/s1600/National+Geographic+HD+Wallpapers+32.jpg\"},{\"source\":\"Yahoo\",\"width\":1280,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.M565e72ecfbd1ab341574919c20c7a200H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_1595.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 2\",\"height\":1024,\"image\":\"http://4.bp.blogspot.com/-oIHXE6heQ1A/UMtCosOwmJI/AAAAAAAADJE/DxJ-K8P_Shg/s1600/National+Geographic+HD+Wallpapers+37.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse1.mm.bing.net/th?id=OIP.Mc7fd1f89827fab014ebb65297bff695fo0&pid=15.1\",\"url\":\"http://ngm.nationalgeographic.com/wallpaper/\",\"title\":\"Photography - Desktop Wallpaper - National Geographic Magazine\",\"height\":1200,\"image\":\"http://ngm.nationalgeographic.com/wallpaper/img/2013/08/12-cboy-zebra-feast_1600.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.Ma8f513c36e238b8efc6f0fd4a094f9dbH0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_9164.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 6\",\"height\":1200,\"image\":\"http://2.bp.blogspot.com/-d7ZQT1KfpLk/UMtFIBhZ1vI/AAAAAAAADK8/cycPVvJB770/s1600/National+Geographic+HD+Wallpapers+52.jpg\"},{\"source\":\"Yahoo\",\"width\":2048,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.M22748c3e8f4b953fd4d19beb5dbce99aH0&pid=15.1\",\"url\":\"http://ww.itimes.com/campaigns/national-geographic-channel\",\"title\":\"National Geographic Channel - Blogs, Polls, Discussions, Events ...\",\"height\":1366,\"image\":\"http://newswatch.nationalgeographic.com/files/2014/02/2_NationalGeographic_684700.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.Mdeb183c9d253de237e8b366efac417a4H0&pid=15.1\",\"url\":\"http://photography-match.com/wallpapers/5680_national_geographic_wallpapers_049\",\"title\":\"National Geographic Wallpapers 049 - National Geographic Photography ...\",\"height\":768,\"image\":\"http://www.photography-match.com/views/images/gallery/National_Geographic_Wallpapers_049.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse2.mm.bing.net/th?id=OIP.Mc6d1b6615bdb0bb3655ed28de33d4897H0&pid=15.1\",\"url\":\"http://adayinthelifeoferikryman.blogspot.com/2012/12/100-most-famous-national-geographic-hd_18.html\",\"title\":\"100 Most Famous National Geographic HD Wallpaper -Part 9 | Unique ...\",\"height\":1200,\"image\":\"http://2.bp.blogspot.com/-Fwj0mVgup38/UMtKN4llZhI/AAAAAAAADO0/xWgx71f_uJA/s1600/National+Geographic+HD+Wallpapers+83.jpg\"},{\"source\":\"Yahoo\",\"width\":1280,\"thumbnail\":\"http://tse2.mm.bing.net/th?id=OIP.M4146457eb42989380c6f2567d94fbeb5H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_16.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 5\",\"height\":1024,\"image\":\"http://1.bp.blogspot.com/-HznoDmcDcek/UMtDkeTu_fI/AAAAAAAADJs/lRf7RPluaBE/s1600/National+Geographic+HD+Wallpapers+42.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse1.mm.bing.net/th?id=OIP.M0cd6267627097607d57868f765eedbcao0&pid=15.1\",\"url\":\"http://photography.nationalgeographic.com/photography/wallpaper/chameleon_pod_image.html\",\"title\":\"... of the Day, Picture, Photography, Wallpapers - National Geographic\",\"height\":768,\"image\":\"http://photography.nationalgeographic.com/staticfiles/NGS/Shared/StaticFiles/Photography/Images/POD/c/chameleon-755888-lw.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.M00dc73755c484623bd70f98953ca8794H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_9164.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 6\",\"height\":1200,\"image\":\"http://2.bp.blogspot.com/-f_dDiwrZrkc/UMtFGB0j8MI/AAAAAAAADK0/nUDSeVj15vA/s1600/National+Geographic+HD+Wallpapers+51.jpg\"},{\"source\":\"Yahoo\",\"width\":1280,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.Mebff55b4be6711a77b002fa8fb654197H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_17.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 7\",\"height\":1024,\"image\":\"http://4.bp.blogspot.com/-d46tny3zxL8/UMtGwjgRhlI/AAAAAAAADMc/NGl04HXedVM/s1600/National+Geographic+HD+Wallpapers+64.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.Me8f76e587c9256677a0e8ffaf5d05be4H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_1595.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 2\",\"height\":768,\"image\":\"http://1.bp.blogspot.com/-fYuA7gWvZgs/UMtCbzV1v1I/AAAAAAAADIk/ep9z704FGnA/s1600/National+Geographic+HD+Wallpapers+33.jpg\"},{\"source\":\"Yahoo\",\"width\":1022,\"thumbnail\":\"http://tse2.mm.bing.net/th?id=OIP.M79538d57c858c4fe56e1a7139d083965H0&pid=15.1\",\"url\":\"http://gallery.wallpaper.free.fr/fond-ecran/national_geographic/index.htm\",\"title\":\"Gallery Wallpaper - 10 photos du National Geographic\",\"height\":767,\"image\":\"http://gallery.wallpaper.free.fr/fond-ecran/national_geographic/images/national_geographic_003_jpg.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.M96d28987202f46aa8be4d5dde679ab27H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_14.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 3\",\"height\":1200,\"image\":\"http://4.bp.blogspot.com/-q0JEnjCW-gw/UMi7oIPU-JI/AAAAAAAADE4/B5xLhcecemg/s1600/National+Geographic+HD+Wallpapers+12.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse2.mm.bing.net/th?id=OIP.Md0ca18be38970b6b327bc7875199c3c5H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_16.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 5\",\"height\":1200,\"image\":\"http://1.bp.blogspot.com/-7Doj82NLeQw/UMtDpNKGHGI/AAAAAAAADJ8/OCvBdQlVD6s/s1600/National%2BGeographic%2BHD%2BWallpapers%2B44.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse1.mm.bing.net/th?id=OIP.Md53f9b13dea0a893dc79dee3d636eae2H0&pid=15.1\",\"url\":\"http://adayinthelifeoferikryman.blogspot.com/2012/12/100-most-famous-national-geographic-hd_16.html\",\"title\":\"100 Most Famous National Geographic HD Wallpaper -Part 6 | Unique ...\",\"height\":768,\"image\":\"http://1.bp.blogspot.com/-paxbg19Oqeg/UMtFckIvI3I/AAAAAAAADLs/OORXepSwyik/s1600/National+Geographic+HD+Wallpapers+58.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.Md3c54b1a7e797a57fd3a853033722307H0&pid=15.1\",\"url\":\"http://www.epacha.org/Pages/National_Geographic.aspx\",\"title\":\"National Geographic\",\"height\":768,\"image\":\"http://images2.fanpop.com/images/photos/6900000/Felines-national-geographic-6909274-1024-768.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.M480ad4b9a8c0fb1d72f897fea292f456H0&pid=15.1\",\"url\":\"http://abc2011101100.blogspot.com/2011/05/national-geographic-hd-wallpapers.html\",\"title\":\"Some Wallpapers: National Geographic HD Wallpapers\",\"height\":1200,\"image\":\"http://1.bp.blogspot.com/-e2oiYY8Wfkc/Tbx623NUlPI/AAAAAAAAAhI/lqkvzeyr4Cc/s1600/Garcya.us_National_Geographic_HD_0015.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.Ma24eb03e33a0a8fefdb4a48a9a9349d0H0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.co.uk/2012/12/100-most-famous-national-geographic-hd_2932.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 10\",\"height\":900,\"image\":\"http://2.bp.blogspot.com/-JR6aypZqvRs/UMtLQhHxa-I/AAAAAAAADPs/UMpa8VIDyGc/s1600/National+Geographic+HD+Wallpapers+90.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse2.mm.bing.net/th?id=OIP.Mfa560f45e2b49e0a8e2e6e6e03dad89dH0&pid=15.1\",\"url\":\"http://photography.nationalgeographic.com/photography/photo-of-the-day/hallstatt-austria-dusk/\",\"title\":\"... Picture -- Travel Wallpaper -- National Geographic Photo of the Day\",\"height\":1200,\"image\":\"http://images.nationalgeographic.com/wpf/media-live/photos/000/610/custom/61072_1600x1200-wallpaper-cb1354545206.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse3.mm.bing.net/th?id=OIP.Mc3b4909f80d7a78f5626b5174fb85f2fo0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_14.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 3\",\"height\":768,\"image\":\"http://3.bp.blogspot.com/-8_VuM7it3ZM/UMi7sTQ5gcI/AAAAAAAADFM/0iGTWjDHUkE/s1600/National+Geographic+HD+Wallpapers+15.jpg\"},{\"source\":\"Yahoo\",\"width\":1920,\"thumbnail\":\"http://tse1.mm.bing.net/th?id=OIP.M2dbccd793739739fba367f3419c3aea6H0&pid=15.1\",\"url\":\"http://184.105.132.122:6830/clubs/national-geographic/images/7822279/title/nature-full-hd-wallpaper-wallpaper\",\"title\":\"National Geographic Nature Full HD Wallpaper\",\"height\":1080,\"image\":\"http://images2.fanpop.com/images/photos/7800000/Nature-Full-HD-Wallpaper-national-geographic-7822279-1920-1080.jpg\"},{\"source\":\"Yahoo\",\"width\":1600,\"thumbnail\":\"http://tse1.mm.bing.net/th?id=OIP.Md06da87050f70caadb941daf4a43c3a7H0&pid=15.1\",\"url\":\"http://mariaxhe.blogspot.com/2012/02/national-geographic.html\",\"title\":\"MariaJose: National Geographic\",\"height\":1200,\"image\":\"http://4.bp.blogspot.com/-RPYUA6Rczp0/TlkZAqm36-I/AAAAAAAABhg/A3ybS0ZvPNE/s1600/National+Geographic+%2528105%2529.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.Md2afdaf51aa7d878823cec9a06525f7cH0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 1\",\"height\":768,\"image\":\"http://4.bp.blogspot.com/-vSA1HCtGoig/UMi6B9yRfhI/AAAAAAAADDY/a2yOiR35lvA/s1600/National+Geographic+HD+Wallpapers+1.jpg\"},{\"source\":\"Yahoo\",\"width\":1024,\"thumbnail\":\"http://tse4.mm.bing.net/th?id=OIP.M8e199ca147a7403dfae6a57dd77346dfo0&pid=15.1\",\"url\":\"http://wallpapersa.blogspot.com/2012/03/national-geographic.html\",\"title\":\"Wallpapers - HD Desktop Wallpapers Free Online: National Geographic\",\"height\":768,\"image\":\"http://4.bp.blogspot.com/-EYteEbXkkfQ/T2b_Fx9xLZI/AAAAAAAAAo8/PxtwMkHogI0/s1600/tylosaurus-squalicorax-caught-on-camera-catching-a-shart-national-geographic.jpg\"},{\"source\":\"Yahoo\",\"width\":1280,\"thumbnail\":\"http://tse1.mm.bing.net/th?id=OIP.Mee17996c5fad0095a308ac5051d164f2o0&pid=15.1\",\"url\":\"http://unikwallpaper.blogspot.com/2012/12/100-most-famous-national-geographic-hd_6539.html\",\"title\":\"... Wallpaper: 100 Most Famous National Geographic HD Wallpaper -Part 8\",\"height\":1024,\"image\":\"http://4.bp.blogspot.com/-w9vtRMrFdN0/UMtI-vi_lxI/AAAAAAAADN0/Ix3i8KIGjnA/s1600/National+Geographic+HD+Wallpapers+75.jpg\"}]}";

}

